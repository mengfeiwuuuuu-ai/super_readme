{% extends "base.html" %}

{% block title %}{{ blog_title }} - é¦–é¡µ{% endblock %}

{% block content %}
<div class="container">
    <!-- å¤´éƒ¨æ¨ªå¹… -->
    <section class="hero">
        <div class="hero-content">
            <h1 class="hero-title">{{ blog_title }}</h1>
            <p class="hero-subtitle">{{ blog_subtitle }}</p>
            {% if current_user.is_authenticated %}
            <div class="hero-user-info">
                <span>ğŸ‘‹ æ¬¢è¿å›æ¥ï¼Œ<strong>{{ current_user.username }}</strong></span>
                {% if current_user.is_admin %}
                <span class="badge badge-primary">ç®¡ç†å‘˜</span>
                {% endif %}
            </div>
            {% endif %}
            {% if search_query %}
            <p class="search-result-info">
                æœç´¢ "<strong>{{ search_query }}</strong>" çš„ç»“æœï¼Œå…± {{ pagination.total }} ç¯‡
                <a href="{{ url_for('index') }}" class="btn btn-sm btn-outline">æ¸…é™¤æœç´¢</a>
            </p>
            {% endif %}
        </div>
    </section>

    <!-- åˆ†ç±»æ ‡ç­¾ -->
    <section class="category-tags">
        <a href="{{ url_for('index') }}"
           class="category-tag {% if not current_category %}active{% endif %}">
            ğŸ“‹ å…¨éƒ¨
        </a>
        {% for cat in all_categories %}
        <a href="{{ url_for('index', category=cat.slug) }}"
           class="category-tag {% if current_category == cat.slug %}active{% endif %}"
           style="--tag-color: {{ cat.color }}">
            {{ cat.icon }} {{ cat.name }}
        </a>
        {% endfor %}
    </section>

    <!-- æ–‡ç« åˆ—è¡¨ -->
    <section class="posts-grid">
        {% if posts %}
            {% for post in posts %}
            <article class="post-card">
                {% if post.cover_image %}
                <div class="post-card-image">
                    <img src="{{ post.cover_image }}" alt="{{ post.title }}" loading="lazy">
                </div>
                {% endif %}
                <div class="post-card-body">
                    <div class="post-card-meta">
                        {% for cat in post.categories %}
                        <span class="post-category" style="background-color: {{ cat.color }}">
                            {{ cat.icon }} {{ cat.name }}
                        </span>
                        {% endfor %}
                        <span class="post-date">
                            <i class="far fa-calendar"></i>
                            {{ post.created_at.strftime('%Y-%m-%d') }}
                        </span>
                    </div>
                    <h2 class="post-card-title">
                        <a href="{{ url_for('view_post', slug=post.slug) }}">{{ post.title }}</a>
                    </h2>
                    <p class="post-card-summary">{{ post.summary }}</p>
                    <div class="post-card-footer">
                        <span class="post-author">
                            <i class="far fa-user"></i>
                            {{ post.author.username if post.author else 'ä½šå' }}
                        </span>
                        <span class="post-views">
                            <i class="far fa-eye"></i> {{ post.view_count }}
                        </span>
                        <a href="{{ url_for('view_post', slug=post.slug) }}" class="read-more">
                            é˜…è¯»æ›´å¤š <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </article>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-inbox fa-3x"></i>
                <h3>æš‚æ— æ–‡ç« </h3>
                <p>è¿˜æ²¡æœ‰å‘å¸ƒä»»ä½•æ–‡ç« ï¼Œè¯·ç¨åå†æ¥ã€‚</p>
                {% if current_user.is_authenticated and current_user.is_admin %}
                <a href="{{ url_for('editor') }}" class="btn btn-primary">å†™ç¯‡æ–‡ç« </a>
                {% endif %}
            </div>
        {% endif %}
    </section>

    <!-- åˆ†é¡µ -->
    {% if pagination.pages > 1 %}
    <nav class="pagination">
        {% if pagination.has_prev %}
        <a href="{{ url_for('index', page=pagination.prev_num, category=current_category, q=search_query) }}"
           class="page-link">
            <i class="fas fa-chevron-left"></i> ä¸Šä¸€é¡µ
        </a>
        {% endif %}

        {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page_num %}
                <a href="{{ url_for('index', page=page_num, category=current_category, q=search_query) }}"
                   class="page-link {% if page_num == pagination.page %}active{% endif %}">
                    {{ page_num }}
                </a>
            {% else %}
                <span class="page-ellipsis">...</span>
            {% endif %}
        {% endfor %}

        {% if pagination.has_next %}
        <a href="{{ url_for('index', page=pagination.next_num, category=current_category, q=search_query) }}"
           class="page-link">
            ä¸‹ä¸€é¡µ <i class="fas fa-chevron-right"></i>
        </a>
        {% endif %}
    </nav>
    {% endif %}
</div>
{% endblock %}
